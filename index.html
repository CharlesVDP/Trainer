<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<meta charset="utf-8" />
	<title>Data Collector</title>
	<style>
		.box {
			width: 50px;
			height: 50px;
			position: fixed;
			top: 3px;
			left: 74px;
			display: none;
			border-radius: 10px;
		}

		body{
			width: 100vw;
			height: 100vh;
		}

		#stop{
			display:none;
		}
		
		.custom-border-radius{
			border-top-left-radius: 0px;
			border-top-right-radius: 0px;
			border-bottom-left-radius: 10px;
			border-bottom-right-radius: 10px;
			border-top: none;
		}

		.btn{
			width: 15vw;
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row align-items-center justify-content-between">
			<div id="score" class="col-auto">
				<h5 class="text-secondary">Score: 0</h5>
			</div>
			<div class="col-auto">
				<button id="start" class="btn btn-sm btn-outline-info custom-border-radius">Start</button>
				<button id="stop" class="btn btn-sm btn-outline-danger custom-border-radius">Stop</button>
			</div>
			<div id="score" class="col-auto">
				<h5 class="text-secondary">Accuracy: 0%</h5>
			</div>
		</div>
		<div class="row align-items-center justify-content-center">
			
		</div>
		
	</div>
</body>
</html>

<script type="text/javascript">
	$(function () {
		let started = false;
		let data = [];
		let row = [];

		function addBox() {
			let x = (Math.random() * (window.innerWidth - 50)).toFixed(0);
			let y = (Math.random() * (window.innerHeight - 50)).toFixed(0);

			y = y < 25 ? 30 : y;

			$('body').append(`<div class="box bg-info" style="left:${x}px; top:${y}px;"></div>`);
			$('.box').fadeIn(200);
		}

		$(document).on('click', '.box', function () {
			$(this).fadeOut(200);
			$(this).remove();
			addBox();
		});

		$(document).on('click', function () {
			if (started && row.length > 0) {
				data.push(row);
				row = [];
			}
		});

		$('body').on('mousemove', function (e) {
			let x = e.screenX;
			let y = e.screenY;

			if (started) {
				row.push([x, y]);
			}
		});

		$('body').on('mouseleave', function () {
			row = [];
		});

		$('#start').on('click', function (e) {
			e.stopPropagation();
			started = true;
			addBox();
			$(this).hide();
			$('#stop').fadeIn(250);
		});

		$('#stop').on('click', function (e) {
			e.stopPropagation();
			started = false;
			download();
			$(this).hide();
			$('.box').remove();
			$('#start').fadeIn(250);
		})

		function download() {
			let json = {};
			json['data'] = data;
			let jsons = JSON.stringify(json);
			var hiddenElement = document.createElement('a');
			hiddenElement.href = 'data:text/json;charset=utf-8,' + encodeURI(jsons);
			hiddenElement.target = '_blank';
			hiddenElement.download = 'data.JSON';
			hiddenElement.click();
		}
	})
</script>